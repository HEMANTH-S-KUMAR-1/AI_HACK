<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Viewer Messages - Admin</title>
    <style>
        body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 2rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 2rem; }
        th, td { border: 1px solid #444; padding: 0.5rem; }
        th { background: #222; }
        tr:nth-child(even) { background: #181818; }
        .error { color: #ff4444; padding: 1rem; text-align: center; }
        .loading { color: #00ffff; padding: 1rem; text-align: center; }
    </style>
</head>
<body>
    <h1>Viewer Messages</h1>
    <div id="status"></div>
    <table id="messagesTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Email</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <script>
        const status = document.getElementById('status');
        const tbody = document.querySelector('#messagesTable tbody');
        
        status.innerHTML = '<div class="loading">Loading messages...</div>';
        
        fetch('http://localhost:3001/api/messages')
            .then(res => {
                if (!res.ok) throw new Error('Failed to fetch messages');
                return res.json();
            })
            .then(messages => {
                status.innerHTML = '';
                if (messages.length === 0) {
                    status.innerHTML = '<div class="loading">No messages yet.</div>';
                    return;
                }
                messages.reverse().forEach(msg => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${new Date(msg.date).toLocaleString()}</td>
                        <td>${escapeHtml(msg.name)}</td>
                        <td>${escapeHtml(msg.email)}</td>
                        <td>${escapeHtml(msg.message)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                status.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            });
            
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>